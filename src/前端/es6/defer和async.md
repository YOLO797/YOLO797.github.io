---
title: defer和async
icon: page
date: 2023-04-11
category:
  - 前端
tag:
  - 前端
  - ES6
sticky: true
star: true
---

defer和async是script的两个标签，用于在不阻塞页面文档解析的前提下，控制脚本的下载和执行。

<!-- more -->

### 1. 页面的加载和渲染过程

1. 浏览器通过 `HTTP` 协议请求服务器，获取 `HTML` 文档并开始从上到下解析，构建 `DOM`
2. 在构建过程中，如果遇到外联样式声名和脚本声明，则暂停文档解析，创建新的网络连接，并开始下载样式文件和脚本文件
3. 样式文件和脚本文件下载完成后，解析并执行，然后继续文档解析
4. 解析完成后，视图渲染到浏览器窗口

在这个过程中，**脚本文件的下载和执行是与文档解析同步进行，即它会阻塞文档解析**，会造成白屏等影响。

### 2. defer

用于开启新的线程下载脚本文件，并使脚本在文档解析完成后执行。即**脚本会被延迟到整个页面都解析完毕后在运行**。因此，在 `<script>` 元素种设置 `defer` 属性，相当于告诉浏览器 ==立即下载，延迟执行==

如果有多个 `defer` 脚本，会按照它们在页面出现的顺序加载

### 3. async

新增属性，用于异步下载脚本文件，下载完毕后立即解析执行文件。与 `defer` 不同的是，标记为 `async` 的脚本并不保证按照它们的先后顺序执行。

如果有多个 `async` 脚本，不能保证加载顺序，是乱序的



### 4. 区别

- `<script src="script.js"></script>`

  浏览器立即加载并执行指定的脚本，“立即”指的是在渲染该 `script` 标签之下是文档元素之前，也就是说不等待后续载入的文档元素，==读到就加载并执行==

- `<script src="script.js" async></script>`

  `async` ，==加载和渲染==后续文档元素的过程将和 `script.js` 的加载与执行==并行进行==（异步）

- `<script src="script.js" defer></script>`

  `defer`，==加载==后续文档元素的过程将和 `script.js` 的加载==并行进行==（异步），但==执行要在所有元素解析完成后==， `DOMContentLoaded`事件触发之前完成
